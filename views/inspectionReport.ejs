<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <title><%= typeof editMode !== 'undefined' ? (editMode ? 'Edit' : 'Create') : 'Create' %> Inspection Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="/src/table.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/fa/all.min.css">
  <link rel="icon" href="/img/Calapan_City_Logo.png" type="image/png">
  <style>
    @media print {
      body * {
        visibility: hidden;
      }
      .print-section, .print-section * {
        visibility: visible;
      }
      .print-section {
        position: absolute;
        left: 0;
        top: 0;
        width: 8.5in;
        height: 13in;
        padding: 0.5in;
        background: white;
        box-sizing: border-box;
      }
      .no-print {
        display: none !important;
      }
      @page {
        size: 8.5in 13in;
        margin: 0.5in;
      }
    }

    /* Print Template Styles */
.report-container {
  border: 2px solid #000;
  padding: 10px 10px 5px; /* Reduced padding-bottom from 10px to 5px */
  max-width: 7.5in;
  margin: 0 auto;
  font-family: "Times New Roman", serif;
  font-size: 10pt;
  box-sizing: border-box;
  height: 11in; /* Usable height after margins */
}
    .form-title {
      font-family: "Times New Roman", serif;
      font-weight: bold;
      font-size: 16pt;
      text-align: center;
      text-transform: uppercase;
      margin-bottom: 5px;
    }
    .lgu-label {
      font-family: "Times New Roman", serif;
      font-weight: bold;
      font-size: 10pt;
      margin-bottom: 10px;
    }
    .header-section {
      display: flex;
      margin-bottom: 10px;
    }
    .header-left {
      width: 70%;
    }
    .header-right {
      width: 30%;
      border: 1px solid #000;
      padding: 5px;
    }
    .input-line {
      border-bottom: 1px solid #000;
      display: inline-block;
      width: 100px;
      min-height: 12px;
      vertical-align: bottom;
    }
    .label-field {
      display: inline-block;
      margin-right: 5px;
    }
    .bold-label {
      font-weight: bold;
    }
    .main-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
      height: 7.8in; /* 65% of 12in */
    }
    .main-table th, .main-table td {
      border: 1px solid #000;
      padding: 4px;
      height: 8mm; /* ~0.3in per row for 25 rows + header */
      font-size: 10pt;
    }
    .main-table th {
      font-weight: bold;
      text-align: center;
    }
    .footer-section {
      display: flex;
      margin-top: 10px;
      height: 2in; /* 20% of 12in */
    }
    .footer-box {
      width: 50%;
      padding: 5px;
      box-sizing: border-box;
    }
    .footer-box-left {
      border-right: 1px solid #000;
    }
    .signature-line {
      border-top: 1px solid #000;
      margin-top: 30px;
      padding-top: 5px;
      text-align: center;
    }
    .footer-notation {
      font-size: 8pt;
      margin-top: 5px;
    }

    /* Modal animations */
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #messageModal[data-show="true"] {
      display: flex;
      animation: modalFadeIn 0.3s ease-out;
    }

    #messageModal .modal-content {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .modal-success #modalIcon { color: #10B981; }
    .modal-error #modalIcon { color: #EF4444; }
    .modal-warning #modalIcon { color: #F59E0B; }
    .modal-info #modalIcon { color: #3B82F6; }

    /* Mobile-specific styles */
    @media (max-width: 640px) {
      .lg\\:ml-64 { margin-left: 0; }
      .lg\\:p-10 { padding: 1rem; }
      .lg\\:grid-cols-2 { grid-template-columns: 1fr; }
      table { font-size: 0.875rem; }
      th, td { padding: 0.5rem; }
      .text-2xl { font-size: 1.5rem; }
      .px-6 { padding-left: 1rem; padding-right: 1rem; }
      .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    }
  </style>
</head>

<body class="bg-blue-50 font-sans min-h-screen">
  <!-- Include Sidebar if you have one -->
  <%- include('partials/sidebar') %>

  <!-- Main Content -->
  <div class="lg:ml-64 p-4 lg:p-10">
    <div class="w-full max-w-7xl mx-auto">
      <div class="bg-white p-4 sm:p-6 lg:p-10 rounded-lg shadow-sm">
        <h2 class="text-xl sm:text-2xl font-bold text-blue-700 mb-6">
          <%= typeof editMode !== 'undefined' ? (editMode ? 'Edit' : 'Create') : 'Create' %> Inspection Report - 
          PR <%= report && report.pr_info && report.pr_info.pr_no ? report.pr_info.pr_no : '' %>
        </h2>

        <% if (report && report.pr_info && report.pr_info.pr_id) { %>
        <form id="inspectionForm" action="/inspection-report/<%= report.pr_info.pr_id %>/save" method="POST">
          <input type="hidden" name="pr_no" value="<%= report.pr_info.pr_no %>">
          <input type="hidden" name="po_id" value="<%= report.po_info && report.po_info.po_id ? report.po_info.po_id : '' %>">

          <!-- PR Information -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6">
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-blue-600 border-b pb-2">PR Information</h3><br>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">PR No.</label>
                <input type="text" value="<%= report.pr_info.pr_id %>" class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" readonly>
              </div>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">Requisitioning Office/Dept</label>
                <input type="text" name="requisitioning_office" 
                       value="<%= report.pr_info.requisitioning_office || '' %>" 
                       class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" required>
              </div>
            </div>

            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-blue-600 border-b pb-2">Fund Information</h3><br>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">Fund</label>
                <input type="text" name="fund" 
                       value="<%= report.pr_info.fund || '' %>" 
                       class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" required>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-gray-600 mb-2 text-sm sm:text-base">AIR No.</label>
                  <input type="text" name="air_no" 
                         value="<%= report.pr_info.air_no || '' %>" 
                         class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base">
                </div>
                <div>
                  <label class="block text-gray-600 mb-2 text-sm sm:text-base">AIR Date</label>
                  <input type="date" name="air_date" 
                         value="<%= report.pr_info.air_date || '' %>" 
                         class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base">
                </div>
              </div>
            </div>
          </div>

          <!-- PO Information -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6">
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-blue-600 border-b pb-2">PO Information</h3>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">PO No. *</label>
                <input type="text" name="po_no" 
                       value="<%= report.po_info && report.po_info.po_no ? report.po_info.po_no : '' %>" 
                       class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" 
                       required>
              </div>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">PO Date *</label>
                <input type="date" name="po_date" 
                       value="<%= report.po_info && report.po_info.po_date ? new Date(report.po_info.po_date).toISOString().split('T')[0] : '' %>" 
                       class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base">
              </div>
            </div>

            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-blue-600 border-b pb-2">Supplier & Invoice</h3>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">Supplier</label>
                <input type="text" value="<%= report.po_info && report.po_info.supplier ? report.po_info.supplier : '' %>" class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" readonly>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-gray-600 mb-2 text-sm sm:text-base">Invoice No.</label>
                  <input type="text" name="invoice_no" 
                         value="<%= report.po_info && report.po_info.invoice_no ? report.po_info.invoice_no : '' %>" 
                         class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base">
                </div>
                <div>
                  <label class="block text-gray-600 mb-2 text-sm sm:text-base">Invoice Date</label>
                  <input type="date" name="invoice_date" 
                         value="<%= report.po_info && report.po_info.invoice_date ? report.po_info.invoice_date : '' %>" 
                         class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base">
                </div>
              </div>
            </div>
          </div>

          <!-- Items Table -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-blue-600 border-b pb-2 mb-4">Items</h3>
            <div class="overflow-x-auto">
              <table class="min-w-full border text-sm sm:text-base">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="border p-2 sm:p-3 text-left text-gray-600">Checked</th>
                    <th class="border p-2 sm:p-3 text-left text-gray-600">Stock Property No.</th>
                    <th class="border p-2 sm:p-3 text-left text-gray-600">Description</th>
                    <th class="border p-2 sm:p-3 text-left text-gray-600">Unit</th>
                    <th class="border p-2 sm:p-3 text-left text-gray-600">Quantity</th>
                  </tr>
                </thead>
                <tbody>
                    <% if (report.items && report.items.length > 0) { %>
                      <% report.items.forEach((item, index) => { %>
                        <tr>
                          <td class="border p-2 sm:p-3">
                            <input type="checkbox" name="item_checked_<%= index %>" 
                                   class="item-checkbox h-4 w-4" 
                                   <%= item.checked ? 'checked' : '' %>
                                   data-item-id="<%= index %>">
                          </td>
                          <td class="border p-2 sm:p-3"><%= item.stock_property_no || 'N/A' %></td>
                          <td class="border p-2 sm:p-3"><%= item.item_description || 'N/A' %></td>
                          <td class="border p-2 sm:p-3"><%= item.unit || 'N/A' %></td>
                          <td class="border p-2 sm:p-3"><%= item.quantity || '0' %></td>
                        </tr>
                      <% }); %>
                    <% } else { %>
                      <tr>
                        <td colspan="5" class="border p-2 sm:p-3 text-center">No items found</td>
                      </tr>
                    <% } %>
                  </tbody>
              </table>
            </div>
          </div>

          <!-- Acceptance Section -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-blue-600 border-b pb-2 mb-4">ACCEPTANCE</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">Date Received</label>
                <input type="date" name="date_received" 
                       value="<%= report.acceptance && report.acceptance.date_received ? report.acceptance.date_received : '' %>" 
                       class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" required>
              </div>
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">Status</label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input type="radio" name="acceptance_status" value="complete" 
                           <%= !report.acceptance || report.acceptance.status !== 'partial' ? 'checked' : '' %> 
                           class="mr-2 h-4 w-4" required>
                    Complete
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="acceptance_status" value="partial" 
                           <%= report.acceptance && report.acceptance.status === 'partial' ? 'checked' : '' %> 
                           class="mr-2 h-4 w-4" id="partialRadio">
                    Partial (please specify):
                  </label>
                  <input type="text" name="notes" 
                         value="<%= report.acceptance && report.acceptance.notes ? report.acceptance.notes : '' %>" 
                         class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 ml-6 text-sm sm:text-base <%= !report.acceptance || report.acceptance.status !== 'partial' ? 'hidden' : '' %>" 
                         id="partialNotes">
                </div>
              </div>
            </div>
          </div>

          <!-- Inspection Section -->
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-blue-600 border-b pb-2 mb-4">INSPECTION</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
              <div>
                <label class="block text-gray-600 mb-2 text-sm sm:text-base">Date Inspected</label>
                <input type="date" name="date_inspected" 
                       value="<%= report.inspection && report.inspection.date_inspected ? report.inspection.date_inspected : '' %>" 
                       class="w-full p-2 sm:p-3 border rounded-lg bg-blue-50 text-sm sm:text-base" required>
              </div>
              <div class="flex items-end">
                <label class="flex items-center">
                  <input type="checkbox" checked disabled class="mr-2 h-4 w-4">
                  <span class="text-sm sm:text-base">Inspected, verified and found in order as to quantity and specifications</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 no-print">
            <a href="/inspection-form/<%= report.pr_info.pr_id %>" 
               class="bg-gray-500 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-sm hover:bg-gray-600 text-sm sm:text-base text-center">
              Cancel
            </a>
            <button type="button" onclick="printReport()" 
                    class="bg-green-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-sm hover:bg-green-700 text-sm sm:text-base">
              Print Report
            </button>
            <button type="submit" class="bg-blue-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-sm hover:bg-blue-800 text-sm sm:text-base">
              <%= typeof editMode !== 'undefined' ? (editMode ? 'Update' : 'Save') : 'Save' %> Report
            </button>
          </div>
        </form>
        <% } else { %>
          <div class="bg-red-100 p-4 rounded text-red-800 text-sm sm:text-base">
            Error: Invalid report data. Please try again or contact support.
          </div>
        <% } %>
      </div>
    </div>
  </div>

<!-- Print Template -->
<div id="printTemplate" class="hidden">
  <div class="print-section">
    <!-- Form Title -->
    <div class="form-title">ACCEPTANCE AND INSPECTION REPORT</div>
    <!-- LGU Label -->
    <div class="lgu-label">LGU: CITY OF CALAPAN</div>
    <div class="report-container">
      <!-- Header Section -->
      <div class="header-section">
        <div class="header-left">
          <div>
            <span class="label-field">Supplier:</span>
            <div class="input-line" id="printSupplier"></div>
          </div>
          <div>
            <span class="label-field">PO No./Date:</span>
            <div class="input-line" id="printPoInfo"></div>
          </div>
          <div>
            <span class="label-field">Requisitioning Office/Dept.:</span>
            <div class="input-line" id="printReqOffice"></div>
          </div>
        </div>
        <div class="header-right">
          <div>
            <span class="label-field">Fund:</span>
            <div class="input-line" id="printFund"></div>
          </div>
          <div>
            <span class="label-field">AIR No.:</span>
            <div class="input-line" id="printAirNo"></div>
          </div>
          <div>
            <span class="label-field">Date:</span>
            <div class="input-line" id="printAirDate"></div>
          </div>
          <div>
            <span class="label-field">Invoice No.:</span>
            <div class="input-line" id="printInvoiceNo"></div>
          </div>
          <div>
            <span class="label-field">Date:</span>
            <div class="input-line" id="printInvoiceDate"></div>
          </div>
        </div>
      </div>
      
      <!-- Main Table -->
      <table class="main-table">
        <thead>
          <tr>
            <th style="width: 10%;">Stock/Property No.</th>
            <th style="width: 50%;">Description</th>
            <th style="width: 15%;">Unit</th>
            <th style="width: 15%;">Quantity</th>
          </tr>
        </thead>
        <tbody id="printItemsBody">
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
          <tr><td></td><td></td><td></td><td></td></tr>
        </tbody>
      </table>
      
      <!-- Footer Section -->
      <div class="footer-section">
        <div class="footer-box footer-box-left">
          <div><span class="bold-label">ACCEPTANCE</span></div>
          <div>
            <span class="label-field">Date Received:</span>
            <div class="input-line" id="printDateReceived"></div>
          </div>
          <div>
            <span id="printCompleteStatus">[X] Complete</span>
            <span id="printPartialStatus" style="margin-left: 20px;">[ ] Partial (pls Specify)</span>
          </div>
          <div class="signature-line">
            <div class="bold-label">ROMMEL P. MASONSGSONG</div>
            <div>Asst. City General Services Officer</div>
          </div>
        </div>
        <div class="footer-box">
          <div><span class="bold-label">INSPECTION</span></div>
          <div>
            <span class="label-field">Date Inspected:</span>
            <div class="input-line" id="printDateInspected"></div>
          </div>
          <div>
            [X] Inspected, verified and found in order as to quantity and specifications
          </div>
          <div class="signature-line">
            <div class="bold-label">DARWIN C. LOPEZ</div>
            <div>Inspection Officer</div>
          </div>
        </div>
      </div>
      
      <!-- Footer Notation -->
      <div class="footer-notation">AIR 2021 v.0</div>
    </div>
  </div>
</div>  
  <!-- Modal Structure -->
  <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-4 sm:p-6 max-w-md w-full mx-4">
      <div id="modalIcon" class="text-3xl sm:text-4xl mb-4 text-center">
        <!-- Icon will be inserted here -->
      </div>
      <h3 id="modalTitle" class="text-lg sm:text-xl font-bold mb-2 text-center"></h3>
      <p id="modalMessage" class="text-gray-600 mb-6 text-center text-sm sm:text-base"></p>
      <div class="flex justify-center">
        <button id="modalClose" class="px-4 sm:px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm sm:text-base">
          OK
        </button>
      </div>
    </div>
  </div>

  <% if (typeof message !== 'undefined' && message) { %>
    <script>
      window.flashMessage = '<%- JSON.stringify(message) %>';
    </script>
  <% } %>
  <script>
    // Persist checkbox states
    let checkedItems = JSON.parse(localStorage.getItem('checkedItems_<%= report.pr_info.pr_id %>')) || {};

    // Initialize checkboxes from saved state
    document.querySelectorAll('.item-checkbox').forEach(checkbox => {
      const itemId = checkbox.dataset.itemId;
      checkbox.checked = checkedItems[itemId] || false;
      
      checkbox.addEventListener('change', () => {
        checkedItems[itemId] = checkbox.checked;
        localStorage.setItem('checkedItems_<%= report.pr_info.pr_id %>', JSON.stringify(checkedItems));
      });
    });

    // Show/hide partial notes field
    document.querySelectorAll('input[name="acceptance_status"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const notesField = document.getElementById('partialNotes');
        notesField.classList.toggle('hidden', this.value !== 'partial');
        if (this.value === 'partial') {
          notesField.required = true;
        } else {
          notesField.required = false;
        }
      });
    });

    // Modal functionality
    const messageModal = document.getElementById('messageModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const modalIcon = document.getElementById('modalIcon');
    const modalClose = document.getElementById('modalClose');

    function showModal(type, title, message) {
      messageModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      messageModal.classList.add(`modal-${type}`);
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      let iconHtml = '';
      switch(type) {
        case 'success':
          iconHtml = '<i class="fas fa-check-circle"></i>';
          break;
        case 'error':
          iconHtml = '<i class="fas fa-times-circle"></i>';
          break;
        case 'warning':
          iconHtml = '<i class="fas fa-exclamation-triangle"></i>';
          break;
        case 'info':
          iconHtml = '<i class="fas fa-info-circle"></i>';
          break;
      }
      modalIcon.innerHTML = iconHtml;
      messageModal.style.display = 'flex';
      setTimeout(() => {
        messageModal.setAttribute('data-show', 'true');
      }, 10);
    }

    modalClose.addEventListener('click', () => {
      messageModal.setAttribute('data-show', 'false');
      setTimeout(() => {
        messageModal.style.display = 'none';
      }, 300);
    });

    messageModal.addEventListener('click', (e) => {
      if (e.target === messageModal) {
        messageModal.setAttribute('data-show', 'false');
        setTimeout(() => {
          messageModal.style.display = 'none';
        }, 300);
      }
    });

    function printReport() {
      const form = document.getElementById('inspectionForm');
      if (!form) {
        showModal('error', 'Print Error', 'Cannot find form data');
        return;
      }

      // Format dates for display
      const formatDate = (dateStr) => {
        if (!dateStr) return '';
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
      };

      // Set header values
      document.getElementById('printSupplier').textContent = document.querySelector('input[name="supplier"]')?.value || '';
      document.getElementById('printPoInfo').textContent = `${form.elements['po_no'].value || ''} / ${formatDate(form.elements['po_date'].value)}`;
      document.getElementById('printReqOffice').textContent = form.elements['requisitioning_office'].value || '';
      document.getElementById('printFund').textContent = form.elements['fund'].value || '';
      document.getElementById('printAirNo').textContent = form.elements['air_no'].value || '';
      document.getElementById('printAirDate').textContent = formatDate(form.elements['air_date'].value);
      document.getElementById('printInvoiceNo').textContent = form.elements['invoice_no'].value || '';
      document.getElementById('printInvoiceDate').textContent = formatDate(form.elements['invoice_date'].value);
      
      // Set acceptance/inspection values
      document.getElementById('printDateReceived').textContent = formatDate(form.elements['date_received'].value);
      document.getElementById('printDateInspected').textContent = formatDate(form.elements['date_inspected'].value);
      
      // Set status checkboxes
      const status = form.elements['acceptance_status'].value;
      if (status === 'partial') {
        document.getElementById('printCompleteStatus').textContent = '[ ] Complete';
        document.getElementById('printPartialStatus').textContent = `[X] Partial (${form.elements['notes'].value || ''})`;
      } else {
        document.getElementById('printCompleteStatus').textContent = '[X] Complete';
        document.getElementById('printPartialStatus').textContent = '[ ] Partial (pls Specify)';
      }

      // Populate items table
      const itemsBody = document.getElementById('printItemsBody');
      itemsBody.innerHTML = '';
      
      const items = document.querySelectorAll('#inspectionForm table tbody tr');
      let rowCount = items.length;
      if (rowCount > 22) rowCount = 22; // Cap at 25 rows
      for (let i = 0; i < rowCount; i++) {
        const item = items[i];
        const cells = item.querySelectorAll('td');
        if (cells.length >= 5) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${cells[1].textContent || ''}</td>
            <td>${cells[2].textContent || ''}</td>
            <td>${cells[3].textContent || ''}</td>
            <td>${cells[4].textContent || ''}</td>
          `;
          itemsBody.appendChild(row);
        }
      }
      // Add empty rows to reach 25
      for (let i = rowCount; i < 22; i++) {
        const row = document.createElement('tr');
        row.innerHTML = '<td></td><td></td><td></td><td></td>';
        itemsBody.appendChild(row);
      }

      // Open print window
      const printTemplate = document.getElementById('printTemplate');
      if (!printTemplate) {
        showModal('error', 'Print Error', 'Cannot print: Report data is not available');
        return;
      }
      
      const printContent = printTemplate.cloneNode(true);
      printContent.classList.remove('hidden');
      
      const printWindow = window.open('', '', 'width=800,height=600');
      printWindow.document.write('<html><head><title>Inspection Report</title>');
      printWindow.document.write('<style>');
      printWindow.document.write(`
        body { 
          font-family: "Times New Roman", serif; 
          margin: 0; 
          padding: 0.5in; 
          font-size: 10pt; 
        }
        .report-container { 
          border: 2px solid #000; 
          padding: 10px 10px 5px;; 
          max-width: 7.5in; 
          margin: 0 auto; 
          height: 11.5in; 
          box-sizing: border-box; 
        }
        .form-title { 
          font-family: "Times New Roman", serif; 
          font-weight: bold; 
          font-size: 16pt; 
          text-align: center; 
          text-transform: uppercase; 
          margin-bottom: 5px; 
        }
        .lgu-label { 
          font-family: "Times New Roman", serif; 
          font-weight: bold; 
          font-size: 10pt; 
          margin-bottom: 10px; 
        }
        .header-section { 
          display: flex; 
          margin-bottom: 10px; 
        }
        .header-left { 
          width: 70%; 
        }
        .header-right { 
          width: 30%; 
          border: 1px solid #000; 
          padding: 5px; 
        }
        .input-line { 
          border-bottom: 1px solid #000; 
          display: inline-block; 
          width: 100px; 
          min-height: 12px; 
          vertical-align: bottom; 
        }
        .label-field { 
          display: inline-block; 
          margin-right: 5px; 
        }
        .bold-label { 
          font-weight: bold; 
        }
        .main-table { 
          width: 100%; 
          border-collapse: collapse; 
          margin-bottom: 10px; 
          height: 7.8in; 
        }
        .main-table th, .main-table td { 
          border: 1px solid #000; 
          padding: 4px; 
          height: 8mm; 
          font-size: 10pt; 
        }
        .main-table th { 
          font-weight: bold; 
          text-align: center; 
        }
        .footer-section { 
          display: flex; 
          margin-top: 10px; 
          height: 1.8in; 
        }
        .footer-box { 
          width: 50%; 
          padding: 5px; 
          box-sizing: border-box; 
        }
        .footer-box-left { 
          border-right: 1px solid #000; 
        }
        .signature-line { 
          border-top: 1px solid #000; 
          margin-top: 30px; 
          padding-top: 5px; 
          text-align: center; 
        }
        .footer-notation { 
          font-size: 8pt; 
          margin-top: 0px; 
        }
        @media print {
          body { padding: 0; }
          .report-container { border: 2px solid #000; padding: 10px; }
        }
      `);
      printWindow.document.write('</style></head><body>');
      printWindow.document.write(printContent.innerHTML);
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      
      printWindow.onload = function() {
        printWindow.focus();
        printWindow.print();
        printWindow.close();
      };
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      if (window.flashMessage) {
        showModal('info', 'Notice', window.flashMessage);
      }
      const partialRadio = document.getElementById('partialRadio');
      if (partialRadio && partialRadio.checked) {
        document.getElementById('partialNotes').classList.remove('hidden');
      }
    });
  </script>
</body>
</html>