<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Department List</title>
  <link href="/src/table.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link rel="icon" href="/img/Calapan_City_Logo.png" type="image/png">
</head>

<body class="bg-blue-50 font-sans">
  <!-- Include Sidebar -->
  <%- include('partials/sidebar') %>

  <!-- Main Content -->
  <div class="lg:ml-64 p-7 lg:p-10">
    <div class="w-full">
      <div class="bg-white p-6 lg:p-10 rounded-lg shadow-sm">
        <h2 class="text-2xl font-bold text-blue-700 mb-6">Department List</h2>

        <% if (typeof error !== 'undefined' && error) { %>
          <p class="text-red-500 mb-4"><%= error %></p>
        <% } %>

        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200 shadow-sm rounded-lg">
            <thead>
              <tr class="bg-blue-700 text-white">
                <th class="p-4 text-left">Department ID</th>
                <th class="p-4 text-left">Department Code</th>
                <th class="p-4 text-left">Department Name</th>
                <th class="p-4 text-left">Department Head</th>
                <th class="p-4 text-left">Position</th>
                <th class="p-4 text-left">Contact Person</th>
                <th class="p-4 text-left">Contact Number</th>
                <th class="p-4 text-left">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% departments.forEach(department => { %>
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="p-4"><%= department.department_id %></td>
                  <td class="p-4"><%= department.department_code %></td>
                  <td class="p-4"><%= department.department_name %></td>
                  <td class="p-4"><%= department.department_head %></td>
                  <td class="p-4"><%= department.position %></td>
                  <td class="p-4"><%= department.contact_person %></td>
                  <td class="p-4"><%= department.contact_number %></td>
                  <td class="p-4">
                    <a href="#" 
                       class="text-blue-600 hover:underline edit-btn"
                       data-id="<%= department.department_id %>"
                       data-code="<%= department.department_code %>"
                       data-name="<%= department.department_name %>"
                       data-head="<%= department.department_head %>"
                       data-position="<%= department.position %>"
                       data-person="<%= department.contact_person %>"
                       data-number="<%= department.contact_number %>">
                       <i class="fas fa-edit"></i>
                    </a> |
                    <a href="#" 
                       class="text-red-600 hover:underline delete-btn"
                       data-id="<%= department.department_id %>">
                       <i class="fas fa-trash-alt"></i>
                    </a>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
      <h2 class="text-xl font-bold mb-4">Edit Department</h2>
      <form id="editForm" action="/departments/edit" method="POST">
        <input type="hidden" name="department_id" id="editDepartmentId">
        <div class="mb-4">
          <label for="editDepartmentCode" class="block text-gray-700">Department Code</label>
          <input type="text" name="department_code" id="editDepartmentCode" class="w-full p-2 border rounded-lg">
        </div>
        <div class="mb-4">
          <label for="editDepartmentName" class="block text-gray-700">Department Name</label>
          <input type="text" name="department_name" id="editDepartmentName" class="w-full p-2 border rounded-lg">
        </div>
        <div class="mb-4">
          <label for="editDepartmentHead" class="block text-gray-700">Department Head</label>
          <input type="text" name="department_head" id="editDepartmentHead" class="w-full p-2 border rounded-lg">
        </div>
        <div class="mb-4">
          <label for="editPosition" class="block text-gray-700">Position</label>
          <input type="text" name="position" id="editPosition" class="w-full p-2 border rounded-lg">
        </div>
        <div class="mb-4">
          <label for="editContactPerson" class="block text-gray-700">Contact Person</label>
          <input type="text" name="contact_person" id="editContactPerson" class="w-full p-2 border rounded-lg">
        </div>
        <div class="mb-4">
          <label for="editContactNumber" class="block text-gray-700">Contact Number</label>
          <input type="text" name="contact_number" id="editContactNumber" class="w-full p-2 border rounded-lg">
        </div>
        <div class="flex justify-end">
          <button type="button" class="px-4 py-2 bg-gray-500 text-white rounded-lg mr-2" onclick="closeEditModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-blue-700 text-white rounded-lg">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg w-80">
      <h2 class="text-xl font-bold mb-4">Delete Department</h2>
      <p>Are you sure you want to delete this department?</p>
      <form id="deleteForm" action="/departments/delete" method="POST">
        <input type="hidden" name="department_id" id="deleteDepartmentId">
        <div class="flex justify-end mt-4">
          <button type="button" class="px-4 py-2 bg-gray-500 text-white rounded-lg mr-2" onclick="closeDeleteModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg">Delete</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript for Modals -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Attach event listener to all "Edit" buttons
      document.querySelectorAll(".edit-btn").forEach(button => {
        button.addEventListener("click", function (event) {
          event.preventDefault(); // Prevent default anchor behavior

          let id = this.getAttribute("data-id");
          let code = this.getAttribute("data-code");
          let name = this.getAttribute("data-name");
          let head = this.getAttribute("data-head");
          let position = this.getAttribute("data-position");
          let person = this.getAttribute("data-person");
          let number = this.getAttribute("data-number");

          openEditModal(id, code, name, head, position, person, number);
        });
      });

      // Attach event listener to all "Delete" buttons
      document.querySelectorAll(".delete-btn").forEach(button => {
        button.addEventListener("click", function (event) {
          event.preventDefault();

          let id = this.getAttribute("data-id");
          openDeleteModal(id);
        });
      });
    });

    function openEditModal(id, code, name, head, position, person, number) {
      document.getElementById('editDepartmentId').value = id;
      document.getElementById('editDepartmentCode').value = code;
      document.getElementById('editDepartmentName').value = name;
      document.getElementById('editDepartmentHead').value = head;
      document.getElementById('editPosition').value = position;
      document.getElementById('editContactPerson').value = person;
      document.getElementById('editContactNumber').value = number;
      
      document.getElementById('editForm').action = "/departments/edit/" + id;
      document.getElementById('editModal').classList.remove('hidden');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
    }

    function openDeleteModal(id) {
      document.getElementById('deleteDepartmentId').value = id;
      document.getElementById('deleteModal').classList.remove('hidden');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.add('hidden');
    }
  </script>
</body>
</html>