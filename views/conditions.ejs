<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Conditions</title>
  <link href="/src/table.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link rel="icon" href="/img/Calapan_City_Logo.png" type="image/png">
</head>

<body class="bg-blue-50 font-sans">
  <!-- Include Sidebar -->
  <%- include('partials/sidebar') %>

  <!-- Main Content -->
  <div class="lg:ml-64 p-7 lg:p-10">
    <div class="w-full">
      <div class="bg-white p-6 lg:p-10 rounded-lg shadow-sm">
        <h2 class="text-2xl font-bold text-blue-700 mb-6">Conditions</h2>

        <% if (error) { %>
          <p class="text-red-500 mb-4"><%= error %></p>
        <% } %>

        <% if (success) { %>
          <p class="text-green-500 mb-4"><%= success %></p>
        <% } %>

        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200 shadow-sm rounded-lg">
            <thead>
              <tr class="bg-blue-700 text-white">
                <th class="p-4 text-left">Condition Code</th>
                <th class="p-4 text-left">Condition Description</th>
                <th class="p-4 text-left">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% conditions.forEach(condition => { %>
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="p-4"><%= condition.condition_code %></td>
                  <td class="p-4"><%= condition.condition_desc %></td>
                  <td class="p-4">
                    <a href="#" 
                       class="text-blue-600 hover:underline edit-btn"
                       data-id="<%= condition.id %>"
                       data-code="<%= condition.condition_code %>"
                       data-desc="<%= condition.condition_desc %>">
                       <i class="fas fa-edit"></i>
                    </a> |
                    <a href="#" 
                       class="text-red-600 hover:underline delete-btn"
                       data-id="<%= condition.id %>">
                       <i class="fas fa-trash-alt"></i>
                    </a>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
      <h2 class="text-xl font-bold mb-4">Edit Condition</h2>
      <form id="editForm" action="/conditions/edit" method="POST">
        <input type="hidden" name="id" id="editConditionId">
        <div class="mb-4">
          <label for="editConditionCode" class="block text-gray-700">Condition Code</label>
          <input type="text" name="condition_code" id="editConditionCode" class="w-full p-2 border rounded-lg" required>
        </div>
        <div class="mb-4">
          <label for="editConditionDesc" class="block text-gray-700">Condition Description</label>
          <input type="text" name="condition_desc" id="editConditionDesc" class="w-full p-2 border rounded-lg" required>
        </div>
        <div class="flex justify-end">
          <button type="button" class="px-4 py-2 bg-gray-500 text-white rounded-lg mr-2" onclick="closeEditModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-blue-700 text-white rounded-lg">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Archive Modal -->
  <div id="archiveModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg w-80">
      <h2 class="text-xl font-bold mb-4">Archive Condition</h2>
      <p>Are you sure you want to archive this condition?</p>
      <form id="archiveForm" action="/conditions/archive" method="POST">
        <input type="hidden" name="id" id="archiveConditionId">
        <div class="flex justify-end mt-4">
          <button type="button" class="px-4 py-2 bg-gray-500 text-white rounded-lg mr-2" onclick="closeArchiveModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg">Archive</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript for Modals -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Attach event listener to all "Edit" buttons
      document.querySelectorAll(".edit-btn").forEach(button => {
        button.addEventListener("click", function (event) {
          event.preventDefault(); // Prevent default anchor behavior

          let id = this.getAttribute("data-id");
          let code = this.getAttribute("data-code");
          let desc = this.getAttribute("data-desc");

          openEditModal(id, code, desc);
        });
      });

      // Attach event listener to all "Delete" buttons
      document.querySelectorAll(".delete-btn").forEach(button => {
        button.addEventListener("click", function (event) {
          event.preventDefault();

          let id = this.getAttribute("data-id");
          openArchiveModal(id);
        });
      });
    });

    function openEditModal(id, code, desc) {
      console.log("Editing Condition ID:", id);  // Debugging
      console.log("Condition Code:", code);
      console.log("Condition Description:", desc);

      document.getElementById('editConditionId').value = id;
      document.getElementById('editConditionCode').value = code;
      document.getElementById('editConditionDesc').value = desc;
      
      document.getElementById('editForm').action = "/conditions/edit/" + id;
      document.getElementById('editModal').classList.remove('hidden');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
    }

    function openArchiveModal(id) {
      document.getElementById('archiveConditionId').value = id;
      document.getElementById('archiveModal').classList.remove('hidden');
    }

    function closeArchiveModal() {
      document.getElementById('archiveModal').classList.add('hidden');
    }
  </script>
</body>
</html>